function plot_the_simualtions_circle(X,DX,X_initial,Center,Radius,Target,Option)

close all


% if (Option.animation==1)
%     plot_animation(X,Option)
% end
%%
screensize = get( 0, 'Screensize' );
figure1 = figure();
set(figure1,'Position',screensize)
limits=Option.limits;
axes1 = axes('Parent',figure1);
% Create axes
hold(axes1,'on');
ylim(axes1,[limits(3) limits(4)]);
xlim(axes1,[limits(1) limits(2)]);
axis equal
box(axes1,'on');
grid(axes1,'on');
set(axes1,'FontSize',20,'TickLabelInterpreter','latex');
ylim(axes1,[limits(3) limits(4)]);
xlim(axes1,[limits(1) limits(2)]);
r = Radius ;
th = linspace(0,2*pi) ;
x = r*cos(th)+Center(1) ;
y = r*sin(th)+Center(2) ;
patch('YData',y,'XData',x,'FaceAlpha',0.6,...
    'LineStyle','none',...
    'FaceColor',[0.850980401039124 0.325490206480026 0.0980392172932625],'DisplayName','Contact surface') ;

scatter(Center(1),Center(2),150,'DisplayName','Center','MarkerFaceAlpha',0.9,...
    'MarkerFaceColor',[1 0 0],...
    'MarkerEdgeColor',[1 0 0]);


scatter(Target(1),Target(2),150,'DisplayName','Target','MarkerFaceAlpha',0.9,...
    'MarkerFaceColor',[0.494117647409439 0.184313729405403 0.556862771511078],...
    'MarkerEdgeColor','none',...
    'Marker','hexagram');

t = linspace(0,2*pi);
rin =Radius;
rout = Radius+Option.rho;
xin = Center(1) + rin*cos(t);
xout =Center(1) + rout*cos(t);
yin = Center(2)+ rin*sin(t);
yout = Center(2) + rout*sin(t);
patch([xout,xin],[yout,yin],'g','linestyle','none','facealpha',0.3,'DisplayName','Transition region',...
    'FaceAlpha',0.3,...
    'LineStyle','none',...
    'FaceColor',[0.850980401039124 0.325490206480026 0.0980392172932625]);

% h1=plot(X_initial(1,:),X_initial(2,:),...
%     'MarkerFaceColor',[0.466666668653488 0.674509823322296 0.18823529779911],...
%     'MarkerEdgeColor','none',...
%     'MarkerSize',30,...
%     'Marker','hexagram',...
%     'LineWidth',5,...
%     'LineStyle','none');
terget_size=[1 10];
for i=1:size(X,2)
    x_tmp(i,:)=imresize(X{i}(1,:),terget_size);
    y_tmp(i,:)=imresize(X{i}(2,:),terget_size);
    dx_tmp(i,:)=imresize(DX{i}(1,:),terget_size);
    dy_tmp(i,:)=imresize(DX{i}(2,:),terget_size);
end
legend(axes1,'show');
quiver(x_tmp,y_tmp,dx_tmp,dy_tmp,1,'method','cubic')
% for i=1:size(X,2)
%     streamslice(X{i}(1,:),X{i}(2,:),DX{i}(1,:),DX{i}(2,:))
%     %     h8{i} = plot(X{i}(1,:),X{i}(2,:),'LineWidth',4,'Color',[0 0 i/size(X,2)]);
% end


% legend2=legend([h1(1) h2 h3 h4 h5 h8{i}],'The initial positions','The target','The contact surface', 'Desired contact location', 'Leaving point','Executed motion');
% set(legend2,'Orientation','vertical','Location','best');
%%
% clearvars h1 h2 h3 h4 h5 h6 h7 h8
% subplot1 = subplot(5,2,[8 10]);
% hold(subplot1,'on');
% box(subplot1,'on');
% grid(subplot1,'on');
% title('Velocity of the motion normal to the surface.')
% xlabel('$Time [s]$','Interpreter','latex');
% ylabel('$Proj_{\dot{X}}$','Interpreter','latex');
% set(subplot1,'FontSize',20);
% for i=1:size(X,2)
%     h1{i} = plot(Time{i}',N_x'*DX{i},'LineWidth',4,'Color',[0 0 i/size(X,2)]);
% end
%%
% clearvars h1 h2
% subplot1 = subplot(5,2,[7 9]);
% hold(subplot1,'on');
% box(subplot1,'on');
% grid(subplot1,'on');
% set(subplot1,'FontSize',20);
% title('Force exerted by the surface to the motion.')
% for i=1:size(X,2)
%     h1{i} = plot(Time{i}',N_x'*F{i},'LineWidth',4,'Color',[0 0 i/size(X,2)]);
% end
% xlabel('$Time [s]$','Interpreter','latex');
% ylabel('$F[N]$','Interpreter','latex');





function plot_animation(X,Poly,X_initial,X_target,X_free,X_C,X_L,N_x,Option)
Limits=Option.limits;
% close all;
% screensize = get( 0, 'Screensize' );
% fig = figure();
% axes1 = axes('Parent',fig);
% set(fig,'Position',screensize)
% plot_Wall_counters(axes1,N_x,X_free,X_C,X_L,Option.rho,Limits)
X1=[ Option.axes1.XLim(1):0.05: Option.axes1.XLim(2)];
X2=[ Option.axes1.YLim(1):0.05: Option.axes1.YLim(2)]';
cla
legend('off');
X1=repmat(X1,size(X2,1),1);
X2=repmat(X2,1,size(X1,2));
Walla=zeros(size(X2));
Wall_Base=Option.N_x'*Option.X_C;

Handle_sign=sign(Option.N_x'*Option.X_free);
for ii=1:size(X2,1),
    for jj=1:size(X2,2)
        XX=[X1(ii,jj);X2(ii,jj)];
        Walla(ii,jj)=Handle_sign*(Option.N_x'*XX-Wall_Base)+...
            (Option.rho-(Option.X_L-Option.X_C)'*(Option.X_L-XX))*exp(-Option.kamma_slider*(Option.X_L-XX)'*(Option.X_L-XX));
        if  Option.rho<(Walla(ii,jj))
            Walla(ii,jj)=Option.rho;
        end
        if Walla(ii,jj)<-2
            Walla(ii,jj)=-2;
        end
    end
end
clim=[-2 Option.rho];
contourf(X1,X2,Walla);
colormap(hot);
hold on

h2=plot(X_target(1,1),X_target(2,1),'MarkerFaceColor',[0 0 1],...
    'MarkerEdgeColor','none',...
    'MarkerSize',30,...
    'Marker','pentagram',...
    'LineWidth',5,...
    'LineStyle','none');

h1=plot(X_initial(1,:),X_initial(2,:),...
    'MarkerFaceColor',[0.466666668653488 0.674509823322296 0.18823529779911],...
    'MarkerEdgeColor','none',...
    'MarkerSize',30,...
    'Marker','hexagram',...
    'LineWidth',5,...
    'LineStyle','none');
hold on
X_wall(1,:) = linspace(Limits(1,1),Limits(1,2),10^5);
X_wall(2,:) = Poly(1)*X_wall+Poly(2);
h3=plot(X_wall(1,:),X_wall(2,:),'LineWidth',4,...
    'LineStyle','--',...
    'Color',[0 0 0]);
hold on

h4=plot(X_C(1,1),X_C(2,1),...
    'MarkerFaceColor',[0 0.447058826684952 0.74117648601532],...
    'MarkerSize',30,...
    'Marker','^',...
    'LineStyle','none');
if Option.Onsurface==0
    h5=plot(X_L(1,1),X_L(2,1),...
        'MarkerFaceColor',[1 0 0],...
        'MarkerSize',30,...
        'Marker','v',...
        'LineStyle','none');
    legend2=legend([h1(1) h2 h3 h4 h5],'The initial positions','The target','The contact surface', 'Desired contact location', 'Leaving point');
else
    legend2=legend([h1(1) h2 h3 h4],'The initial positions','The target','The contact surface', 'Desired contact location');
end
set(legend2,'Orientation','horizontal','Location','northwest');
SIZE=size(X{1},2);
for i=1:size(X,2)
    H_animated{i}=animatedline('Color','b','LineWidth',3);
    if size(X{i},2)<SIZE
        SIZE=size(X{i},2);
    end
end
counter=1;
while counter<SIZE
    for i=1:size(X,2)
        addpoints(H_animated{i},X{i}(1,counter),X{i}(2,counter))
        drawnow
    end
    counter=int64(counter+size(X{i},2)/abs(10*Option.Tfinal));
end
